Integrating the Healthcare Enterprise 




IHE Patient Care Device Domain
Technical Framework Supplement

Point-of-Care Identity Management 
(PCIM)



Draft in preparation for Public Comment


Date:		Error! Unknown document property name.
Author:	IHE PCD Technical Committee, PCIM Work Group
Email:		pcd@ihe.net


Foreword
This is a supplement to the IHE Patient Care Device Domain Technical Framework <V5.0>. Each supplement undergoes a process of public comment and trial implementation before being incorporated into the volumes of the Technical Frameworks.
This supplement is published onError! Unknown document property name. for Public Comment. Comments are invited and may be submitted at http://www.ihe.net/<domain>/<domain>comments.cfm. In order to be considered in development of the Trial Implementation version of the supplement, comments must be received by <Month XX, 201X>. 
This supplement describes changes to the existing technical framework documents. 
“Boxed” instructions like the sample below indicate to the Volume Editor how to integrate the relevant section(s) into the relevant Technical Framework volume.
Amend section X.X by the following:
Where the amendment adds text, make the added text bold underline. Where the amendment removes text, make the removed text bold strikethrough. When entire new sections are added, introduce with editor’s instructions to “add new text” or similar, which for readability are not bolded or underlined.

General information about IHE can be found at: www.ihe.net.
Information about the IHE Patient Care Device domain can be found at: http://www.ihe.net/Domains/index.cfm.
Information about the organization of IHE Technical Frameworks and Supplements and the process used to create them can be found at: http://www.ihe.net/About/process.cfm and http://www.ihe.net/profiles/index.cfm.
The current version of the IHE Patient Care Device Domain Technical Framework can be found at: http://www.ihe.net/Technical_Framework/index.cfm.
<Comments may be submitted on IHE Technical Framework templates any time at http://ihe.net/ihetemplates.cfm. Please enter comments/issues as soon as they are found. Do not wait until a future review cycle is announced.

CONTENTS

1.1 Introduction to this Supplement	4
1.2 Open Issues and Questions	5
1.3 Closed Issues	5
1.4	5
2. General Introduction	6
Appendix A - Actor Summary Definitions	6
Appendix B - Transaction Summary Definitions	6
3. Glossary	6
Volume 1 – Profiles	9
7. Point-of-Care Identity Management (PCIM) Profile	10
3.1 7.1 PCIM Actors, Transactions, and Content Modules	10
3.1.1 Device-Patient Association Reporter	12
3.1.2 Device-Patient Association Consumer	12
3.1.3 Device Registrant	12
3.1.4 Device-Patient Association Manager	12
3.2 7.2  Actor Options	12
3.3 7.3  Required Actor Groupings	13
3.4 7.4  Overview	13
3.5 7.4.1 Concepts	13
3.6 Use Cases	13
3.7 Use Case #1: Associating Device with Patient	13
3.8 Use Case #1 Associating Device with Patient:	13
3.9 Description	13
3.10 7.4.2.1.2 Use Case #1 Associating Device with Patient: Process Flow	14
3.11 Pre-conditions:	14
3.12 Main Flow:	14
3.13 Post-conditions:	14
3.14 Use Case #2: Disassociating Device From Patient	14
3.15 Description	14
3.16 Process Flow	14
3.17 Use Case #3 Query the Associated Devices for a Patient	14
3.18 Description	14
3.19 Process Flow	14
3.20	15
3.21 Use Case #4 Query the Associated Patient for a Device	15
3.22 Description	15
3.23 Process Flow	15
3.24 Use Case #5 96919691	15
3.25 Device Registrant Registers a Device with the Device-Patient Association Manager	15
3.26 Description	15
3.27 Identification and supporting information about a device may be registered with the Manager.	15
3.28 Process Flow	15
3.29 Use Case #6 Query the Device Registrant for a list of candidate devices for an association	15
3.30 7.5  Security Considerations in the Use of This Proposed Profile	15
3.31 General IHE PCD Guidance	15
3.32 Risk Assessment and Mitigation for Device-Patient Association Profile	16
3.33 7.6  Cross Profile Considerations	16
Volume 2 – Transactions	17
1.1	Assert Device-Patient Association [PCD-17]>	17
3.17.1 Scope	17
3.17.2 Actor Roles	17
3.17.3 Referenced Standards	17
3.17.4 Interaction Diagram	17
3.17.4.1 Device-Patient Association Report	17
3.17.4.1.1 Trigger Events	18
3.17.4.1.2 Message Semantics	18
1.2	Assert Device-Patient Disassociation	18
3.17.4.2.1 Trigger Events	19
3.17.4.2.2 Message Semantics	19
3.17.4.2.3 Expected Actions	19
3.33.1 3.17.5 Security Considerations	19
3.17.5.1 Security Audit Considerations	19
3.17.5.1.(z) <Actor> Specific Security Considerations	19
3.33.1.1 3.18.4.1 Device-Patient Disassociation Report	20
1.2.1.1	Device-Patient Disassociation Acknowledgement	21
Appendix A. Proposed Messages	27
A.1 Report Device-Patient Association	27
A.1.1 Message Structure	27
A.1.2 Segments	27
A.1.2.1 MSH – Message Header	27
A.1.2.2 PID – Patient Identification	27
A.1.2.3 PV1 Patient Visit Information	28
A.1.2.4 OBR – Order Request	28
A.1.2.5 OBX – Observation (for Patient ID)	28
A.1.2.6 PRT – Participation (Observation Participation)	29
A.2 Register Device	31
A.2.1 Message Structure	31
A.2.2 Segments	32
A.2.2.1 MSH – Message Header	32
A.2.2.2 MFI – Master File Identification Segment	32
A.2.2.3 MFE – Master File Entry	32
A.2.2.4 PRT – Participation Information Segment	33
A.3 Example Messages	33
A.4 Query: Device-Patient Associations Query Message	35
A.4.1 Scope	35
A.4.2 Use Case Roles	35
A.4.3 Query Message	35
A.4.3.1 MSH Segment	35
A.4.3.2 QPD Segment	36
A.5 Query Response Message	37
A.5.1 MSH Segment	37
A.5.2 MSA Segment	37
A.5.3 QAK Segment	38
A.5.4 QPD Segment	38
A.5.5 Remaining Segments	38
 
1.1 Introduction to this Supplement
This Supplement to the IHE Patient Care Device Technical Frameworks adds the rationale and implementation details of the Point-of-Care Identity Management Profile to the Framework, providing a means for standards-based exchange between systems of information collected and confirmed at the point of care tracking the set of medical devices originating observations about each patient. 
1.2 Open Issues and Questions
The work group solicits feedback on workflow effects and problems found in analyzing the profile and in trial implementation.
1.3 Closed Issues
Discuss differences from previous approaches based on ADT messages: will be faster, closer to the actual events than ADT feeds, which have a different purpose and are often not well synchronized with actual events at the point-of-care. Will enable devices, device controllers and a variety of other hospital systems to flexibly exchange information, publish or subscribe to change notifications.
1.4 
2. General Introduction
Update the following Appendices to the General Introduction as indicated below. Note that these are not appendices to Volume 1.
Appendix A - Actor Summary Definitions
Add the following actors to the IHE Technical Frameworks General Introduction list of Actors:


ActorDefinitionDevice-Patient Association ReporterA system or person that asserts a device-patient association, disassociation, or attributes related to either such as current state or starting and ending times..Device-Patient Association ManagerA system that records, manages, and serves records of device-patient associations.Device-Patient Association ConsumerA system or person that queries a Device-Patient Association Manager for device-patient association records, either as a snapshot of current associations or as a subscription for ongoing updates.Device RegistrantA system (including the device itself) or person that, when the device is set up for use by a Device-Patient Association Manager, uniquely identifies a device instance that may participate in device-patient associations.Device Registration ProviderA system that registers devices and serves device identity information to a Device-Patient Association Manager. May be grouped with that Manager.[P1]
Appendix B - Transaction Summary Definitions
Add the following transactions to the IHE Technical Frameworks General Introduction list of Transactions:

TransactionDefinitionAssert Device-Patient AssociationA Device-Patient Association Reporter asserts to a Device-Patient Association Manager that a device has been associated with a patient, or updates data concerning a reported assertion.Assert Device-Patient DisassociationA Device-Patient Association Reporter asserts to a Device-Patient Association Manager that the association between a device and a patient has been terminated.Query Device-Patient AssociationsA Device-Patient Association Consumer sends a query to a Device-Patient Association Manager concerning the devices associated with a patient or set of patients currently or at a stated past time.Register DeviceA Device Registrant sends, updates, or deletes a record of identifying information on a device instance for storage and use by the Device-Patient Association Manager.3. Glossary
Add the following glossary terms to the IHE Technical Frameworks General Introduction Glossary:


Glossary TermDefinition[RJ2]AssertionA statement that a certain premise is true, for example that a device has been prepared to collect data about a patient.BindingA process of associating two related elements of information.BiometricsA measurable physical characteristic or personal behavioral trait used to recognize the identity, or verify the claimed identity of a person.Direct AssociationA patient association established by the observation and recording of a physical connection of a device to the patient.Direct Device-Patient Association AssertionA claim of direct device-patient association based on evidence.Duplicate Patient Identification Record[RJ3]Two records representing the same patient, with differing identifiers of the same type with the same assigning authority. For example, two different medical record numbers issued by the same hospital to the same patient. In the context of device-patient association, an unintentional duplicate patient record may result if device data is recorded without a permanent unique patient identifier being recorded, as in an emergency. A human-validated merge operation is necessary to associate the device data with the patient after the fact.Entity[RJ4]In the context of this Profile, an organizational unit within a healthcare enterprise, typically, but not necessarily, associated with a free-standing building, office, or sub-unit within a common hospital corporation. For example, a patient visit would occur within a specific entity.Indirect Device-Patient AssociationA patient association asserted on the basis of a common attribute shared by a device and patient, such as a location.Location-based AssertionAn assertion of an association between two objects (e.g. a patient and a device, device-to-device, patient-to-caregiver), based solely upon the co-location (e.g. same room and bed) of these two objects.Observation-Patient AssociationThe assignment of a device measurement/parameter to a specific patient. Observation - patient associations are established through the connection relationship of a unique patient to a unique device at the point in time that the measurement was recorded by the device.Device-Patient Association Conflict NotificationA message from a particular clinical IT system that it detects an inconsistency between different identity assertions. For example, a device and an intermediary system may be simultaneously asserting that a single data stream represents two different patients.Device-Patient Record LinkageThe process of binding and/or associating a discrete patient record to a discrete device record.Precondition"What the system under analysis will ensure is true before letting the use case start."Receiving SystemIn the context of PCIM, any system which is a consumer of device-patient association or observation messages, such as an electronic medical record system, device gateway, or a device at the point of care.RecordThe discrete representation of a specific and unique patient or the device in either the reporting or consuming system's database.Strong Identity AssertionA presumption of patient or device unique recognition using multiple factors that provides a high degree of accuracy and certainty (e.g., barcode, biometric).Strong Identity FactorsAn identifier designed to be unique (applies to only one person) and consistent over the appropriate domain for at least throughout the visit or encounter, for example, Medical Record Number or National ID number.Unique Device IdentifierIn the US, a unique identifier for a medical device that is recognized by the US FDA and which has a part that identifies the maker and model of the device (DI) and a part that identifies the particular instance of the device. More generally, any identifier which allows a particular device to be uniquely identified.Weak Identity AssertionA presumption of patient or device unique recognition using factors that provides a low degree of accuracy and certainty (e.g., name, location).Weak Identity FactorsFactors which can contribute to identification, but typically are not unique to patient; for example, name, sex, date of birth.Volume 1 – Profiles
Add to Section …
4. Point-of-Care Identity Management (PCIM) Profile
The Point-of-Care Identity Management (PCIM) Profile is a Transport Profile specifying HL7 v2 standard messaging for devices and IT systems at an acute-care point-of-care to exchange and synchronize information about the identity of specific devices collecting clinical information about a specific patient, to:
Assist in the reliable association of the collected data to the proper patient record, based on first-hand observation and data entry by a person at the point of care, specifically designed to avoid wrong attribution of data from before or after the period of actual measurement on the patient.
Assist in maintaining a correct “census” of devices that frequently move between patients such as infusion pumps, and mechanical ventilators.
The messaging defined provides for capable devices to originate messages asserting association and disassociation to a particular patient, for human interface software components to afford users the opportunity to originate or confirm association or disassociation assertions, for one or more systems to receive and persist device-patient association information, to distribute reporting messages or receive and respond to queries about such associations.
4.1 7.1 PCIM Actors, Transactions, and Content Modules
This section defines the actors, transactions, and/or content modules in this profile. General definitions of actors are given in the Technical Frameworks General Introduction Appendix A at http://www.ihe.net/Technical Framework/index.cfm.
Figure 7.1-1 shows the actors directly involved in the Profile and the relevant transactions between them. If needed for context, other actors that may be indirectly involved due to their participation in other related profiles are shown in dotted lines.
[RJ5][P6][P7][P8][RJ9]
Figure X.1-1:  Actor Diagram

Table 7.1-1 lists the transactions for each actor directly involved in the  Profile. To claim compliance with this Profile, an actor shall support all required transactions (labeled “R”) and may support the optional transactions (labeled “O”). 
Table 7.1-1:  Profile - Actors and Transactions[RJ10]
ActorsTransactions OptionalityReferenceDevice-Patient Association ReporterReport Device-Patient AssociationR<Domain Acronym> TF-2: 3.Y1Report Device-Patient DisassociationR<Domain Acronym> TF-2: 3.Y2Device-Patient Association ManagerReport Current Device-Patient Association StatusR<Domain Acronym> TF-2: 3.Y1Publish Device-Patient Association EventR<Domain Acronym> TF-2: 3.Y2Device-Patient Association ConsumerQuery Device-Patient AssociationsO<Domain Acronym> TF-2: 3.Y1Subscribe to Device-Patient Association EventsO<Domain Acronym> TF-2: 3.Y2Device Registrant Register DeviceRReport Registered Device DetailsR1. Actor Descriptions and Actor Profile Requirements
Requirements are documented in Transactions (Volume 2) and Content Modules (Volume 3). This section documents any additional requirements on profile’s actors.
4.1.1 Device-Patient Association Reporter
The Device-Patient Association Reporter actor represents a system or person that is asserts that a given device is attached or removed from a specific patient. For each such event, the unique Patient ID, Device ID, and timestamp must minimally be reported.
4.1.2 Device-Patient Association Consumer
The Device-Patient Association Consumer actor represents a system or person that is interested in knowing what devices are or were connected to which patients. A common example is a critical care system that charts device measurements to a patient. 
4.1.3 Device Registrant
The Device Registrant actor represents a system or person that maintains the list of medical devices that can be connected to a patient. The list entry for each device typically includes the device type, location (may not apply if mobile), and unique identity. 
The Device Registrant announces when a device is placed in or taken out of service, is relocated, and other events of its choosing.[P11]
Where this is a person, it is most likely hospital staff that is interacting directly with the Device-Patient Association Manager through its user interface.
Where it is a system, it may be a comprehensive device inventory system, a “gateway” system, or even the device itself. 
4.1.4  Device-Patient Association Manager[P12]
The Device-Patient Association Manager actor represents a system that knows what devices are or were connected to which patients at any given time, and can communicate these associations as query responses, event notifications, or both.
4.2 7.2  Actor Options[RJ13][P14]
The Device-Patient Association Consumer has two options available for receiving data from the Device-Patient Association Manager. The first option is to query the Manager for a snapshot of current associations, either by sending a patient identifier and receiving back the associated device(s) or by sending a device identifier and receiving back the associated patient. The second option is to receive an unsolicited continuous stream of association and disassociation events from the Manager as they occur. The Device-Patient Association Manager should support sending data via both methods, and the Device-Patient Association Consumer may support one or both methods.
4.3 7.3  Required Actor Groupings 
There are no required actor groupings specified in the Point-of-Care Identity Management (PCIM) profile.
4.4 7.4  Overview
4.4.1 7.4.1 Concepts[RJ15][P16]
Properly validated associations between devices, and patients that the devices are sourcing observations for, are an essential underpinning for clinical surveillance and clinical decision support systems. Patient safety depends on certainty that the values being charted do not have gaps, or worse, data from the wrong patient.
This profile provides standards-based messages for communications about the beginning, end, and current state of intervals in which a device is associated with a particular patient. It uses HL7 version 2 messages, still the most common pattern in healthcare institutions for similar information such as patient demographics. It does not specify a particular configuration of systems for its functions, but rather describes roles which may be assigned to different systems according to the workflow in the institution. For example, selection of the patient and the devices could be accomplished on a module of an electronic medical system, on a medical device such as a physiological monitor or ventilator with appropriate communication and display capabilities, or on a hand carried device controlling another healthcare information system.
4.5  Use Cases
4.5.1  Use Case #1: Associating Device with Patient
A Device-Patient Association Reporter asserts a device-patient association to an Device-Patient Association Manager.
4.6  Use Case #1 Associating Device with Patient:
4.6.1 Description
An authorized person at the point of care and able to see the patient and the devices has gathered and checked the unique identifying information for a patient and one or more devices that are designated to originate observations on that patient. To reduce the chances for error, the collection of identifiers  is done with the assistance of Automatic Identification and Data Capture equipment such as a bar code reader. Before being sent, the information is displayed to the operator for verification. Once verified, a message is originated by the Association with the following information:
* Patient identifier unique within the scope of the institution
* Method  (for example, scanned device bar code and patient wrist band, fixed device location, etc.
* Time parameters (typically effective begin time of the association. In the case where only a single set of observation from the device is expected, as for a spot-check monitor, the end time of the association is also known at this time)
* Authorized performing participant
4.7 7.4.2.1.2 Use Case #1 Associating Device with Patient: Process Flow
4.8 Pre-conditions:
Patient is to be associated with a device for clinical observations. Patient has been assigned unique identifier at registration which has been collected and verified at the point of care. Device identify has been registered for use. The identities of patient and device(s) have been collected and verified by an authorized person.
4.9 Main Flow:
Device-Patient Association reporter originates a message with the specific information on the association and its time of beginning.
4.10 Post-conditions:
After completion of this use case, an association record identifying the patient and the associated device and giving the start time of the association is created and persisted by the Device-Patient Association Manager.
4.11 Use Case #2: Disassociating Device From Patient
4.12 Description
At the timbe the device is no longer set up to make observations on the patient, the Device-
Patient Association Reporter originates a message conveying this information to the Device-Patient Association Manager.
4.13 Process Flow
The Device-Patient Association Manager receives the information that the association between a particular patient and one or more devices no longer exists. An authorized operator may originate this message through a user interface. In some cases the device itself is capable of determining that the association has been broken and can communicate this information directly to the Device-Patient Association Manager, or indirectly through the Device-Patient Association Reporter.
4.14 Use Case #3 Query the Associated Devices for a Patient
4.15 Description
A Device-Patient Association Consumer may query a Device-Patient Association Manager for a list of devices associated with a particular patient at present, or at a designated time in the past, or more generally for a snapshot of the Device-Patient Association map.
4.16 Process Flow
For status display or for error-checking and diagnostic purposes, the Device-Patient Association Manager can respond to a targeted query by sending a query message.
4.17 Use Case #4 Query the Associated Patient for a Device
4.18 Description
A device may be able to make use of the identity of the patient it is connected to for display for display or other purposes, but not have this information available to it, so the profile provides for a Device-Patient Association Consumer actor to query the Device-Patient Association Manager for this information.
4.19 Process Flow
The identity of the patient associated with a device (or the lack of an associated patient identity) may be queried for.
4.19.1 Use Case #5 96919691
4.20 Device Registrant Registers a Device with the Device-Patient Association Manager
4.21 Description
Identification and supporting information about a device may be registered with the Manager.
4.22 Process Flow
Before a devibbce can participate in a Device-Patient Association, its identity and basic attributes such a device type, manufacturer and model, and additional identity information such as its regulatory Unique Device Identifier are provided by the Device Registrant to the Device-Patient Association Manager to be persisted and used in the other transactions in this use case.
4.23 Use Case #6 Query the Device Registrant for a list of candidate devices for an association
 A Device Registrant Actor in the present might be used by Device-Patient Association Reporter to allow presentation of a pick list of candidate devices to be paired with a patient
4.24 7.5  Security Considerations in the Use of This Proposed Profile
This profile itself does not impose specific requirements for authentication, encryption, or auditing, leaving these matters to site-specific policy or agreement. The IHE PCD Technical Framework identifies security requirements across all PCD profiles.
To assist the user of this profile with security considerations, a non-exhaustive exemplar of a security risk table is presented below:
4.25 General IHE PCD Guidance
During the profile development there were no unusual security/privacy concerns identified. There are no mandatory security controls, but the implementer is encouraged to use of the underlying security and privacy profiles from ITI that are appropriate to the transports, such as the Audit Trail and Node Authentication (ATNA) Profile. The operational environment risk assessment, following ISO 80001, will determine the actual security and safety controls employed.
4.26 Risk Assessment and Mitigation for Device-Patient Association Profile
Any procedures, manual or automatic, affecting identification of patients and devices in a clinical scenario should of course be subject to analysis of risks and potential mitigations according to the institution’s established policies and procedures for analysis of safety, security, and privacy risk in general, in accordance with general risk analysis best practices. In addition to the risk of clinical data loss or data associated with the wrong patient discussed elsewhere in this document, any other hazards potentially arising from related activities . The profile described in this document cannot be assessed for effects on risk in isolation from the context in which it could be used, particularly routines for assigning unique patient identification codes and manual and automatic means for verifying patient identity during care to assure accuracy. Likewise recording unique device identification of devices and tracking procedures need to be assessed for assurance of correctness. This risk analysis should be carried out by a team including qualified persons in affected clinical and technology departments.
This document describes communications protocols but not full details of user interfaces and implementation of automated rules in actual systems for associating devices with patients, but these implementation details strongly affect the safety and effectiveness of the system in actual use, and therefore deserve careful evaluation.
The transactions described may carry highly sensitive identity information and could potentially be used to follow personal health data if not appropriately secured in health information systems and on health information networks, so privacy is a critical aspect of risk analysis
See the IHE PCD White Paper on Point-of-Care Identity Management Appendix C for additional risk analysis information including discussion of use of IHE Information Technology Infrastructure profiles for security.
4.27 7.6  Cross Profile Considerations
This profile specifically covers associations and disassociations between patients and devices. As patient demographics and ADT information (e.g., patient location) are often integral to satisfying the use cases profiled in this document, implementers should be familiar with the following profiles within the IT Infrastructure Technical Framework:
Patient Administration Management profile
Patient Demographics Query
ITI Patient Demographic Query - Patient Demographic Reporter
A Patient Demographic Consumer in IT Infrastructure might used by a Device-Patient Association Reporter to allow presentation of a pick list of candidate patients to associate with one or more devices at the point-of-care. 
Volume 2 – Transactions

1.1  Assert Device-Patient Association [PCD-17]>
3.17.1 Scope
This transaction is used to by a Device-Patient Association Reporter to assert that an association has been established between a device and a patient, or to update information reported previously by that reporter.
3.17.2 Actor Roles

The Roles in this transaction are defined in the following table and may be played by the actors listed:

Table 3.17.2-1: Actor Roles
Actor:Device-Patient Association ReporterRole:Reporter – the source of the assertion. Identifies the device, the patient, the authority for the association, and the effective time.Actor:Device-Patient Association ManagerRole:Manager – establishes a persistent record of the association.3.17.3 Referenced Standards
HL7 2.6 Chapters 2, 3, 5 and 7
3.17.4 Interaction Diagram

3.17.4.1 Device-Patient Association Report
This is an HL7 Version 2 message giving details of the association being asserted. The message may assert association between more than one device and one patient.
The manager may receive this message from multiple Reporter instances.
3.17.4.1.1 Trigger Events
This message is triggered at the beginning of an interval when the logical connection between a device and the data it originates and a particular patient is established, after that connection has been verified by a human user able to check its validity at the point of care.
3.17.4.1.2 Message Semantics
The significant content of the message is the following:
* Confirmed unique identity of patient, preferably derived from an AIDC (Automatic Identification and Data Capture) such as scanning the patient wristband or reading an RFID tag. Code used to identify the patient must be chosen so as to be unique at least over the scope of the set of patients seen over all information systems in the institution, such as a Medical Record Number issued by the institution for the patient, or, if available, a national id number. The type and issuing entity shall be recorded with the code. Additional identity codes may be provided at the discretion of the institution. Note that any code identifiable with an individual patient must by secured from misuse in accordance with applicable legal and policy procedures.
* Unique identity of Device. This again is determined by site considerations. It is preferable to use a universally unique identification of the individual instance of the device, such as an IEEE EUI-64 or a Unique Device Identifier such as one produced in accordance with the US FDA (or other regulatory agency) UDI standards. If this is not possible, then a local identification scheme allowing all device instances in the institution to be uniquely distinguished and tracked may be used. Additional identification codes may be included. Whatever code is used should be possible to record automatically, as manual data entry has a high error rate, and correct identification is a patient safety concern.
* Identity of the authorized person responsible for obtaining and visually confirming the identity information for the patient and the device.

The form of the message is similar to an unsolicited observation report, with supplementary PRT segments identifying the device, human operator originating the association.
On receipt of the message, the manager system checks for valid syntax and that the:
1. originating Reporter system and human user are authorized for their roles
2. the device is a member of the set of registered device instances and has no current conflicting association recorded (e.g. a single-patient devices has an active association with a different patient)
3. the patient identity provided corresponds to a known person in an appropriate status (e.g. admitted)
After these checks, the Manager logs the result and returns an appropriate positive or negative acknowledgement to the Reporter. The system design must assure that errors are indicated to the appropriate human user(s) in an effective and timely manner so that action can be taken. 
If the checks are passed, the Manager establishes a record of the existence of the association and its effective time.
1.2 Assert Device-Patient Disassociation
A Device-Patient Association Reporter asserts to a Device-Patient Association Manager that the association between a device and a patient has been terminated. A disassociation between more than one device and a patient may be reported in the same message.
The manager may receive this message from multiple Reporter instances.
3.17.4.2.1 Trigger Events
This message is originated at the end of an interval when the logical connection between a device and the data it originates and a particular patient is established. This is normally initiated by an authorized human user after that disconnection has been verified.
If in the risk analysis of the possible operations of the interconnected system shows that a condition that may be automatically detected without being explicitly initiated by a human is a reliable indicator that the association no longer exists (for example if a patient has been moved away from a fixed-location device or another patient has been connected to a device), safe operation of the system may require that a disassociation message be automatically generated and an exception message to 
3.17.4.2.2 Message Semantics
<Detailed description of the meaning, structure and contents of the message, including any IHE specific clarifications of the message format, attributes, etc.>
<Start by describing the standard underlying the message and how the participating actors are mapped (e.g., “This message is a DICOM C-FIND Request. Actor A is the SCU. Actor D is the SCP.”).>
<Continue profiling the message by providing guidance or constraints on how the message parameters are populated, how the payload is encoded, how the message is structured and what the contents mean. These message semantics should both help the sender to construct the message and the receiver to interpret the message.>
3.17.4.2.3 Expected Actions
<Description of the actions expected to be taken as a result of sending or receiving this message.>
<Describe what the receiver is expected/required to do upon receiving this message. >
<Avoid re-iterating the transaction sequencing specified in the Profile Process Flows as expected actions internal to the transaction. Doing so prevents this transaction being re-used in other contexts.>
<Explicitly define any expected action based on the multiplicity of an actor(s), if applicable.>
4.27.1 3.17.5 Security Considerations
<Description of the transaction specific security consideration; such as use of security profiles.>
3.17.5.1 Security Audit Considerations
<This section should identify any specific ATNA security audit event that is associated with this transaction and requirements on the encoding of that audit event. >
3.17.5.1.(z) <Actor> Specific Security Considerations
<This section should specify any specific security considerations on an Actor by Actor basis.>
3.18 Assert Device-Patient Disassociation [PCD-18]>
3.18.1 Scope
This transaction is used to assert the end of the association between a device and a patient. It is verified by an identified, authorized human user
3.18.2 Actor Roles

Table 3.18.2-1: Actor Roles
Actor:Device-Patient Association ReporterRole:Reporter – the source of the assertion. Identifies the device, the patient, the authority for the association, and the effective time.Actor:Device-Patient Association ManagerRole:Manager – establishes a persistent record of the association.3.18.3 Referenced Standards
HL7 2.6 Chapters 2, 3, 5 and 7
3.18.4 Interaction Diagram

4.27.1.1 3.18.4.1 Device-Patient Disassociation Report
Reports that an association previously reported between a device and a patient no longer exists. This is the inverse of the Device-Patient Association Report, The two are similar in form and could have been defined as two variants of the same message, but have been given different names and discussed separately to emphasize differences in effects.
3.18.4.1.1 Trigger Events
This message can be triggered manually. The user interface could display information about the existing association, and an authorized person could select the association and give a command to end it.
If the equipment used has a means available to detect the termination of recording of data from a particular patient, this method could be used to give an operator warning that the association may have been ended, and the
3.17.4.1.2 Message Semantics
The significant content of this message are the identities of the device and the patient that are no longer to be associated, and the identity of the authorized person originating the message
3.17.4.1.3 Expected Actions
The Device-Patient Association Manager records the ending time of the association, persists the record of the time interval of the association, and sends a notification to information system with a subscription covering the event.
1.2.1.1 Device-Patient Disassociation Acknowledgement
The reply to the Device-Patient Disassociation Report is an ordinary HL7 Acknowledgement. 
3.17.5 Security Considerations
No special security or security audit considerations beyond the general ones already discussed apply to this transaction
3.19 Query Device-Patient Associations [PCD-19]>
<The “Y” in the heading should be the same as the # in the [Domain Acronym -#] title>
3.19.1 Scope
This transaction is used to <…describe what is accomplished by using the transaction. Remember that by keeping transactions general/abstract, they can be re-used in a variety of profiles>
3.19.2 Actor Roles
<Optional: if desired, in addition to the table, add a diagram as shown below to illustrate the actors included in this transaction, or delete the diagram altogether.>

Figure 3.Y.2-1: Use Case Diagram

Table 3.Y.2-1: Actor Roles
Actor:<Official actor name; list every actor in this transaction.>Role:<Very brief, one phrase, description of the role that this actor plays in this transaction.>Actor:Role: Actor: Role:<The assignment and use of Role Names in transaction specifications has proved to be very effective/efficient in Radiology, especially when existing transactions are re-used by additional actors. Following is an alternative example of the Role section. Delete which ever form of the role section you choose not to use.>

The Roles in this transaction are defined in the following table and may be played by the actors shown here:
Table 3.19.2-1 Actor Roles
Role:<Role Name:><Only unique within this transaction. Typically one word. The Role Name is analogous to SCU or SCP in DICOM Services.>Actor(s):The following actors may play the role of <Role Name>:
        <Actor Name>: <optionally, the situation where the Actor would play this Role if needed for clarity.>”Role:<e.g., Requestor:
Submits the relevant details and requests the creation of a new workitem.>Actor(s):<e.g., The following actors may play the role of Requestor:
Workitem Creator: when requesting workitems
Workitem Performer: when performing unscheduled workitems>Role:<e.g., Manager:
Creates and manages a Unified Procedure Step instance for the requested
workitem.>Actor(s):<e.g., The following actors may play the role of Manager:
Workitem Manager: when receiving a new workitem for its worklist.>Transaction text specifies behavior for each Role. The behavior of specific Actors may also be specified when it goes beyond that of the general Role.
3.19.3 Referenced Standards
HL7 2.6 Chapters 2, 3, 5 and 7
3.19.4 Interaction Diagram
<The interaction diagram shows the detailed standards-based message exchange that makes up the IHE transaction.>

3.19.4.1 <Message 1 Name>
<One or two sentence summary of what Message 1 accomplishes typically relating the message to the relevant standard. Avoid shall language in this upper level section. Do not duplicate the triggers, encoding, semantics, standards used, or expected actions. Those belong in the following sections.>
<Explicitly state if the multiplicity of an actor may be greater than one; i.e., if an actor (whether it is a client or server) can expect this message from a single source or multiple sources.>
3.19.4.1.1 Trigger Events
<Description of the real world events that cause the sender (Actor A) to send Message 1 (e.g., an operator or an automated function determines that a new workitem is needed).>
3.19.4.1.2 Message Semantics
<Detailed description of the meaning, structure and contents of the message, including any IHE specific clarifications of the message format, attributes, etc.>
<Start by describing the standard underlying the message and how the participating actors are mapped (e.g., “This message is a DICOM C-FIND Request. Actor A is the SCU. Actor D is the SCP.”).>
<Continue profiling the message by providing guidance or constraints on how the message parameters are populated, how the payload is encoded, how the message is structured and what the contents mean. These message semantics should both help the sender to construct the message and the receiver to interpret the message.>
3.19.4.1.3 Expected Actions
<Description of the actions expected to be taken as a result of sending or receiving this message.>
<Describe what the receiver is expected/required to do upon receiving this message. >
<Avoid re-iterating the transaction sequencing specified in the Profile Process Flows as expected actions internal to the transaction. Doing so prevents this transaction being re-used in other contexts.>
<Explicitly define any expected action based on the multiplicity of an actor(s), if applicable.>
3.19.4.2 <Message 2 Name>
<One or two sentence summary of what Message 2 accomplishes typically relating the message to the relevant standard. Avoid shall language in this upper level section. Do not duplicate the triggers, encoding, semantics, standards used, or expected actions. Those belong in the following sections.>
<Explicitly state if the multiplicity of an actor may be greater than one; i.e., if an actor (whether it is a client or server) can expect this message from a single source or multiple sources.>
<Repeat this section as necessary based on the number of messages in the interaction diagram.>
3.19.4.2.1 Trigger Events
<Description of the real world events that cause the sender (Actor A) to send Message 1(e.g., an operator or an automated function determines that a new workitem is needed).>
3.19.4.2.2 Message Semantics
<Detailed description of the meaning, structure and contents of the message, including any IHE specific clarifications of the message format, attributes, etc.>
<Start by describing the standard underlying the message and how the participating actors are mapped (e.g., “This message is a DICOM C-FIND Request. Actor A is the SCU. Actor D is the SCP.”).>
<Continue profiling the message by providing guidance or constraints on how the message parameters are populated, how the payload is encoded, how the message is structured and what the contents mean. These message semantics should both help the sender to construct the message and the receiver to interpret the message.>
3.19.4.2.3 Expected Actions
<Description of the actions expected to be taken as a result of sending or receiving this message.>
<Describe what the receiver is expected/required to do upon receiving this message. >
<Avoid re-iterating the transaction sequencing specified in the Profile Process Flows as expected actions internal to the transaction. Doing so prevents this transaction being re-used in other contexts.>
<Explicitly define any expected action based on the multiplicity of an actor(s), if applicable.>
3.19.5 Security Considerations
<Description of the transaction specific security consideration; such as use of security profiles.>
3.19.5.1 Security Audit Considerations
<This section should identify any specific ATNA security audit event that is associated with this transaction and requirements on the encoding of that audit event. >
3.19.5.1.(z) <Actor> Specific Security Considerations
<This section should specify any specific security considerations on an Actor by Actor basis.>
3.20 Register Device [PCD-20]>

3.20.1 Scope
This transaction is used to <…describe what is accomplished by using the transaction. Remember that by keeping transactions general/abstract, they can be re-used in a variety of profiles>
3.20.2 Actor Roles
<Optional: if desired, in addition to the table, add a diagram as shown below to illustrate the actors included in this transaction, or delete the diagram altogether.>

Figure 3.Y.2-1: Use Case Diagram

Table 3.Y.2-1: Actor Roles
Actor:<Official actor name; list every actor in this transaction.>Role:<Very brief, one phrase, description of the role that this actor plays in this transaction.>Actor:Role: Actor: Role:<The assignment and use of Role Names in transaction specifications has proved to be very effective/efficient in Radiology, especially when existing transactions are re-used by additional actors. Following is an alternative example of the Role section. Delete which ever form of the role section you choose not to use.>

The Roles in this transaction are defined in the following table and may be played by the actors shown here:
Table 3.20.2-1 Actor Roles
Role:<Role Name:><Only unique within this transaction. Typically one word. The Role Name is analogous to SCU or SCP in DICOM Services.>Actor(s):The following actors may play the role of <Role Name>:
        <Actor Name>: <optionally, the situation where the Actor would play this Role if needed for clarity.>”Role:<e.g., Requestor:
Submits the relevant details and requests the creation of a new workitem.>Actor(s):<e.g., The following actors may play the role of Requestor:
Workitem Creator: when requesting workitems
Workitem Performer: when performing unscheduled workitems>Role:<e.g., Manager:
Creates and manages a Unified Procedure Step instance for the requested
workitem.>Actor(s):<e.g., The following actors may play the role of Manager:
Workitem Manager: when receiving a new workitem for its worklist.>Transaction text specifies behavior for each Role. The behavior of specific Actors may also be specified when it goes beyond that of the general Role.
3.20.3 Referenced Standards
HL7 2.6 Chapters 2, 3, 5 and 7
3.20.4 Interaction Diagram
<The interaction diagram shows the detailed standards-based message exchange that makes up the IHE transaction.>

3.20.4.1 <Message 1 Name>
<One or two sentence summary of what Message 1 accomplishes typically relating the message to the relevant standard. Avoid shall language in this upper level section. Do not duplicate the triggers, encoding, semantics, standards used, or expected actions. Those belong in the following sections.>
<Explicitly state if the multiplicity of an actor may be greater than one; i.e., if an actor (whether it is a client or server) can expect this message from a single source or multiple sources.>
3.20.4.1.1 Trigger Events
<Description of the real world events that cause the sender (Actor A) to send Message 1 (e.g., an operator or an automated function determines that a new workitem is needed).>
3.20.4.1.2 Message Semantics
<Detailed description of the meaning, structure and contents of the message, including any IHE specific clarifications of the message format, attributes, etc.>
<Start by describing the standard underlying the message and how the participating actors are mapped (e.g., “This message is a DICOM C-FIND Request. Actor A is the SCU. Actor D is the SCP.”).>
<Continue profiling the message by providing guidance or constraints on how the message parameters are populated, how the payload is encoded, how the message is structured and what the contents mean. These message semantics should both help the sender to construct the message and the receiver to interpret the message.>
3.20.4.1.3 Expected Actions
<Description of the actions expected to be taken as a result of sending or receiving this message.>
<Describe what the receiver is expected/required to do upon receiving this message. >
<Avoid re-iterating the transaction sequencing specified in the Profile Process Flows as expected actions internal to the transaction. Doing so prevents this transaction being re-used in other contexts.>
<Explicitly define any expected action based on the multiplicity of an actor(s), if applicable.>
3.20.4.2 <Message 2 Name>
<One or two sentence summary of what Message 2 accomplishes typically relating the message to the relevant standard. Avoid shall language in this upper level section. Do not duplicate the triggers, encoding, semantics, standards used, or expected actions. Those belong in the following sections.>
<Explicitly state if the multiplicity of an actor may be greater than one; i.e., if an actor (whether it is a client or server) can expect this message from a single source or multiple sources.>
<Repeat this section as necessary based on the number of messages in the interaction diagram.>
3.20.4.2.1 Trigger Events
<Description of the real world events that cause the sender (Actor A) to send Message 1(e.g., an operator or an automated function determines that a new workitem is needed).>
3.20.4.2.2 Message Semantics
<Detailed description of the meaning, structure and contents of the message, including any IHE specific clarifications of the message format, attributes, etc.>
<Start by describing the standard underlying the message and how the participating actors are mapped (e.g., “This message is a DICOM C-FIND Request. Actor A is the SCU. Actor D is the SCP.”).>
<Continue profiling the message by providing guidance or constraints on how the message parameters are populated, how the payload is encoded, how the message is structured and what the contents mean. These message semantics should both help the sender to construct the message and the receiver to interpret the message.>
3.20.4.2.3 Expected Actions
<Description of the actions expected to be taken as a result of sending or receiving this message.>
<Describe what the receiver is expected/required to do upon receiving this message. >
<Avoid re-iterating the transaction sequencing specified in the Profile Process Flows as expected actions internal to the transaction. Doing so prevents this transaction being re-used in other contexts.>
<Explicitly define any expected action based on the multiplicity of an actor(s), if applicable.>
3.20.5 Security Considerations
<Description of the transaction specific security consideration; such as use of security profiles.>
3.20.5.1 Security Audit Considerations
<This section should identify any specific ATNA security audit event that is associated with this transaction and requirements on the encoding of that audit event. >
3.20.5.1.(z) <Actor> Specific Security Considerations
<This section should specify any specific security considerations on an Actor by Actor basis.>




Appendix A. Proposed Messages
These message descriptions are not definitive; rather they are to give an idea of the approach and general expected content. Since they are rooted in the observation reporting messages of IHE PCD Device Enterprise Communications transaction PCD-01, refer to that profile in the current IHE PCD Technical Framework for details omitted here.
A.1 Report Device-Patient Association
As all of the use cases identified in this profile can be considered observations (it was observed that device d1 was connected to patient p1 starting at t1 and ending at t2), the ORU message structure is used throughout this profile to manage associations. 
A.1.1 Message Structure
Appendix Table 1: Report Device Patient Association
SegmentsDescriptionMSHMessage Header[{ SFT }]Software Segment[UAC]User Authentication Credential PIDPatient Identification [PV1]Patient Visit Information (for room bed)  OBRObservation Request{ OBXObservation Result { PRT }Participation}
MSH, SFT, and UAC Segments: Same as DEC Profile.
In the context of this use case, the message is constrained to reporting association(s) for a single patient. This could be single device, single patient, or multiple devices associated to a single patient.
A.1.2 Segments
A.1.2.1 MSH – Message Header
[DCP] We should designate MSH-9 and also decide if we want to specify application acknowledgments, or not, which must be declared in MSH as well.
A.1.2.2 PID – Patient Identification
In order to assert an association between a patient and a device, the PID segment is required. It identifies the patient who is associated to the device.
Appendix Table 2: PID Fields
SEQDTOPTRPDescription1SIOSet ID - PID3CXRYPatient Identifier List5XPNOYPatient Name7DTMREGender8ISREDOBA.1.2.3 PV1 Patient Visit Information
See IHE PCD-01 for basic information. In this profile, the PV1 segment is used to convey patient location information in PV1-3 Assigned Patient Location. This is also usable as a query filter to limit responses from the Device-Patient Association Query to matching locations.
A.1.2.4 OBR – Order Request
This segment serves as a wrapper for an association observation. It gives the association message a unique identifier in the Filler Order Number OBR-3. This acts as an association object instance identifier for tracking is used for tracking messages from all sources in the overall configuration of systems, so it must be constrained so that duplicate identifiers between sources are not possible. It gives the timestamp of the association event.
A.1.2.5 OBX – Observation (for Patient ID)
This segment conveys the “observation” that the patient has been associated to a device. It includes the time stamp of the association event and the device ID. A PRT segment accompanies it to convey additional information about the device. 
Appendix Table 3: OBX Fields
SEQDTOPTRPDescription1SIOSet ID - OBX2IDRValue Type – set to CWE3CWERObservation Identifier – set to 68487^MDCX_ATTR_EVT_COND^MDC4STOObservation Sub-ID. Use to convey a specific channel that’s been associated, as <MDS>.<VMD>.<CHANNEL>.<facet>5CWERObservation Value. See Appendix Table 4: OBX-5 Values on page 2811IDRObservation Result Status. See Appendix Table 5: OBX-11 Values on page 28.Appendix Table 4: OBX-5 Values
Observation ValueDescription0^MDCX_DEV_ASSOCIATE^MDCDevice has been associated to a patient.0^MDCX_DEV_DISASSOCIATE^MDCDevice has been disassociated from a patient.
A device association can be reported as a point-in-time event, in which case a separate disassociate message is required to delineate the end of the association. Alternatively, the association event message can convey a duration during which the association was in effect. The latter is equivalent to an associate/disassociate message pair, and may be preferable for short duration associations (e.g., spot vitals collection).
Appendix Table 5: OBX-11 Values
 StatusHL7 DescriptionAdaptationCRecord coming over is a correction and thus replaces a final result.Record coming over is a correction and thus replaces a validated association.DDeletes the OBX recordDeletes the association record.FFinal results; can only be changed with a corrected result.Validated association. Can only be changed with a corrected association record.RResults entered -- not verifiedAn association has been asserted, but not validated.WPost original as wrong, e.g., transmitted for wrong patient.Post original as wrong, e.g., transmitted for wrong patient.A.1.2.6 PRT – Participation (Observation Participation)
This segment conveys information about persons and/or devices that participated in the association, ancillary to the patient and device that are its subjects. For example:
* A nurse that established and/or validated an association
* A device gateway
* The device itself, if the patient ID is entered directly onto the device
Appendix Table 6: PRT Fields
SEQDTOPTRPDescription2IDRAction Code. Always value to UC (unchanged).4CWERParticipation – see 
PRT-10 should contain some form of identifier sufficient to uniquely identify the device within the scope of the overall system. This is a repeating field, so more than one identifier can be given. See the discussion of OBX-18 in the IHE PCD Technical Framework Volume 2. If possible, it should have as one of its values the Unique Device Identifier defined by the US FDA, where applicable, but in any case must contain See details in the UDI Final Rule (U.S. Food and Drug Administration 2013)


Appendix Table 7: PRT-4 Values.5XCNYParticipation Person. If a person is the participant in this association message, his or her ID and name appear here.9PLYParticipation Location. Location where association was asserted or observed.10EICYParticipation Device. 
If a device is the initiator of this association record (PRT-4 = AUT), its ID appears here. Format is the same as in existing IHE PCD profiles and will match PRT-10 of device-as-subject PRT segment of this message, provided that the device associated with the patient and the device reporting the participation are one and the same (e.g., patient admitted on this monitor).
If this PRT segment identifies this device as the subject of the association (PRT-4 = EQUIP), its ID appears here. Note – Prior to HL7 2.7, this would have appeared in OBX-18.11DTMCParticipation Begin Date/Time (arrival time).
Refer to 
Appendix Table 9: PRT-12 Interpretation on page 30.12DTMCParticipation End Date/Time (departure time).
Refer to 
Appendix Table 8: PRT-11 Interpretation on page 30.
PRT-10 should contain some form of identifier sufficient to uniquely identify the device within the scope of the overall system. This is a repeating field, so more than one identifier can be given. See the discussion of OBX-18 in the IHE PCD Technical Framework Volume 2. If possible, it should have as one of its values the Unique Device Identifier defined by the US FDA, where applicable, but in any case must contain See details in the UDI Final Rule (U.S. Food and Drug Administration 2013)
Appendix Table 7: PRT-4 Values
ParticipationHL7 DescriptionAdaptationAUTAUT Author/Event InitiatorThe participant (nurse, device, etc.), initially asserts the association.EQUIPEquipmentThe participant is the device that is a subject of the device-patient association.ROResponsible ObserverThe participant (nurse, etc.) observes an already asserted association as a prelude to adjusting, validating, or marking in error. Appendix Table 8: PRT-11 Interpretation
Participation StatusAUTEQUIPROR-AssertedTime that the person/device asserted the association between the patient and device.Time that the device-patient association is asserted to have been established.Unusual. Time that the person in this role observed the person/device in the AUT role asserting the association.C-Correctedn/aCorrected time that the device-patient association is asserted to have been established.Time that the person in this role issued the correction.D-Deletedn/an/aTime that the person in this role issued the deletion order.F-Validatedn/aTime that the device-patient association is confirmed to have been established. If null, most recently asserted/corrected time has been confirmed.Time that the person in this role validated the association.W-Wrongn/an/aTime that the person in this role declared the association to be erroneous.
Appendix Table 9: PRT-12 Interpretation
Participation ?
?StatusAUTEQUIPROR-AssertedTime that the person/device asserted the disassociation between the patient and device.Time that the device-patient disassociation is asserted to have taken place.Unusual. Time that the person in this role observed the person/device in the AUT role asserting the disassociation.C-Correctedn/aCorrected time that the device-patient association is asserted to have ended.Time that the person in this role issued the correction.D-Deletedn/an/an/aF-Validatedn/aTime that the device-patient association is confirmed to have ended. If null, most recently asserted/corrected time has been confirmed.Time that the person in this role validated the disassociation.W-Wrongn/an/an/a
A.2 Register Device
These messages are used to report the introduction of a new device or the removal of a device to subscribing actors, including the Device Patient Association Manager. 
As the list of devices available within the facility is best thought of as a master file, the HL7 Master File Notification paradigm is used. For lack of a better alternative, the PRT segment is used to convey device details. While most commonly used to indicate a device’s participation in an observation, it contains the necessary fields for device inventory and is used elsewhere in this profile.
A.2.1 Message Structure
Appendix Table 10: Report Device Patient Association
SegmentsDescriptionMSHMessage Header[{ SFT }]Software Segment[UAC]User Authentication CredentialMFIMaster File Identification{ MFEMaster File Entry PRTParticipation}
MSH, SFT, and UAC Segments: Same as DEC Profile.
A.2.2 Segments
A.2.2.1 MSH – Message Header
MSH-9 is valued to MFN^M14^MFN_PRT
A.2.2.2 MFI – Master File Identification Segment
This segment identifies the master file as the Device Master.
Appendix Table 11: MFI Fields
SEQDTOPTRPDescription1CWERMaster File Identifier – Value to INV (Inventory)2HDOYMaster File Application Identifier – Value to “Device Registrant”3IDRFile-Level Event Code – Value to UPD (Update)6IDRResponse Level Code – Value to NE (No application level response needed)A.2.2.3 MFE – Master File Entry
This segment communicates the event corresponding to the device record.
Appendix Table 12: MFE Fields
SEQDTOPTRPDescription1IDRRecord-Level Event Code (See table below)4HDRYPrimary Key Value (Hospital designated device identifier)5IDRYPrimary Key Value Type (Value to CWE)6DTMOEntered Date/Time7DTMOEffective Date/Time
Appendix Table 13 – Record Level Event Codes
ValueDescriptionMADDevice added to inventory listMDLDevice deleted from inventory listMUPDevice information updatedMDCDevice deactivated, but remains on inventory listMACDeactivated device reactivated
A.2.2.4 PRT – Participation Information Segment
The Participation Information Segment contains device information details. 
Appendix Table 14: PRT Fields
SEQDTOPTRPDescription2IDRAction Code. Always value to UC (unchanged).4CWERParticipation – Value to “EQUIP”9PLOYParticipant Location – Value to the location of the device10EICYParticipation Device – Value to the ID(s) of the device
PRT-10 should contain some form of identifier sufficient to uniquely identify the device within the scope of the overall system. This is a repeating field, so more than one identifier can be given. See the discussion of OBX-18 in the IHE PCD Technical Framework Volume 2. If possible, it should have as one of its values the Unique Device Identifier defined by the US FDA, where applicable, but in any case must contain[RJ17][RJ18] See details in the UDI Final Rule (U.S. Food and Drug Administration 2013)

A.3 Example Messages
Example 1: At 12:00, Nurse Diesel connected patient Spaniel to a continuous physiological monitor with ID MON5588. At 12:30, she records the association on the Critical Care application. As she is an RN and has witnessed and entered the association on the Critical Care system, this is considered a validated association. This message would be sent from the Critical Care system in the role of Association Reporter to the Association Manager.

MSH|^~\&|CritCare||AssocMgr||20160726123002||ORU^R01^ORU_R01|12d15a9|P|2.7|||AL|AL||8859/1|||IHE PCD ORU-R01 2006^HL7^Universal ID^HL72390
PID|||AB60001^^^A^PI||Spaniel^C^R^^^^L
PV1||E|3 WEST ICU^3001^1
OBR|||15404652
OBX|1|CWE|68487^MDCX_ATTR_EVT_COND^MDC||0^MDCX_DEV_ASSOCIATE^MDC||||||F
PRT|1|UC||EQUIP||||||3 WEST ICU^3001^1|MON5588^^231A8456B1CB2366^EUI-64|20160726120000
PRT|2|UC||RO|58793^Diesel^N||||3 WEST ICU^3001^1||20160726123000
The Association Manager first responds with the following commit level acknowledgment.

MSH|^~\&|AssocMgr||CritCare||20160726123002||ACK^R01^ACK||P|2.7
MSA|CA|12d15a9
Once the association is fully processed, the Association Manager responds by initiating the following application level acknowledgment

MSH|^~\&|AssocMgr||CritCare||20160726123003||ACK^R01^ACK|AM52E123|P|2.7|||AL|NE||8859/1|||IHE PCD ORU-R01 2006^HL7^Universal ID^HL72390
MSA|AA|12d15a9
To which the Association Reporter responds with a commit level acknowledgement, completing the exchange.

MSH|^~\&|CritCare||AssocMgr||20160726123003||ACK^R01^ACK||P|2.7
MSA|CA|AM52E123
Example 2: At 16:00, Nurse Ratched connected patient McMurphy to a continuous physiological monitor with ID MON5596. She enters his patient ID on the monitor and presses a button causing the association to be asserted.

MSH|^~\&|MonitorGateway||AssocMgr||20160726160000||ORU^R01^ORU_R01|12d1574|P|2.7|||AL|AL||8859/1|||IHE PCD ORU-R01 2006^HL7^Universal ID^HL72390
PID|||AB60001^^^A^PI||McMurphy^R^P^^^^L
PV1||E|3 WEST ICU^3001^1
OBR|||15404697
OBX|1|CWE|68487^MDCX_ATTR_EVT_COND^MDC||0^MDCX_DEV_ASSOCIATE^MDC||||||R
PRT|1|UC||EQUIP||||||3 WEST ICU^3001^1|MON5588^^231A8456B1CB2366^EUI-64|20160726160000
PRT|1|UC||AUT||||||3 WEST ICU^3001^1|MON5588^^231A8456B1CB2366^EUI-64|20160726160000


(Acknowledgment messages not shown)

The Association Manager may then broadcast this information to subscribers (such as Critical Care), or its clients (such as Critical Care) may query for this information, depending on how the systems are integrated.
At 16:45, she confirms the association on the Critical Care application (or the Association Manager, depending on how the systems are integrated). This message would be sent from the Critical Care system in the role of Association Reporter to the Association Manager.

MSH|^~\&|CritCare||AssocMgr||20160726164500||ORU^R01^ORU_R01|12d1574|P|2.7|||AL|AL||8859/1|||IHE PCD ORU-R01 2006^HL7^Universal ID^HL72390
PID|||AB60001^^^A^PI|| McMurphy^R^P^^^^L
PV1||E|3 WEST ICU^3001^1
OBR|||15404697
OBX|1|CWE|68487^MDCX_ATTR_EVT_COND^MDC||0^MDCX_DEV_ASSOCIATE^MDC||||||F
PRT|1|UC||EQUIP||||||3 WEST ICU^3001^1|MON5588^^231A8456B1CB2366^EUI-64|20160726160000
PRT|2|UC||RO|58787^Ratched^N||||3 WEST ICU^3001^1||20160726164500

(Acknowledgment messages not shown)

Example 3: A new monitor with hospital assigned key MON5588 is registered. It is located at 3 West ICU, Room 3001, Bed 1. Its UDI is 231A8456B1CB2366.

MSH|^~\&|DeviceMaster||AssocMgr||20160726160000|| MFN^M14^ MFN_PRT |12d1574|P|2.7|||AL|AL||8859/1|||IHE PCD ???^HL7^Universal ID^HL72390
MFI|INV|Device Registrant|UPD|||NE
MFE|MAD|||MON5588|CWE
PRT|1|UC||EQUIP||||||3 WEST ICU^3001^1|MON5588^^231A8456B1CB2366^EUI-64|20160726160000

A.4 Query: Device-Patient Associations Query Message
A.4.1 Scope
This query allows a system to request a list of the device-patient associations meeting specified conditions.






A.4.2 Use Case Roles







A.4.3 Query Message

QBPQuery by ParameterChapter in HL7 2.5MSHMessage Header2QPDQuery Parameter Definition5RCPResponse Control Parameter5[DSC]Continuation Pointer2
A.4.3.1 MSH Segment
As for transaction PCD-01 in the IHE PCD Technical Framework.
A.4.3.2 QPD Segment
QPD - Query Parameter Definition
MnemonicDescriptionTypeOptionalityLengthTableRepetitionQPD.1Message Query NameCERequired250471NoQPD.2Query TagSTOptional32NoQPD.3User ParametersVARIESOptional256NoQPD.4Action CodeID323The User Parameters field (QPD.3) is used to specify “filtering” values, so that the query response can be limited to, for example, the records matching a particular Patient Identifier (by including a PID.3 specification), a particular device (by adding a Participation Device PRT specification) and so on. If multiple specifications are given, the responding system “AND”s the specifications together, so that for example, a patient identifier and a device identifier specification result in the response only gives associations involving that patient and device.
The Action Code (QPD.4) is used if a subscription is being modified (specified in RCP-5), and has the value A if a subscription is being added or D if it is being deleted
The form of the specifications in QPD field follows the conventions established by the ITI Patient Data Query Profile (ITI-21, see the ITI Technical Framework, Vol. 2a): one or more repetitions (separated by the HL7 repetition separator, by default the tilde character ~), with each repetition in the form of subcomponent specifying the field, component, or subcomponent to filter on as @<seg>.<field number> followed by a subcomponent giving the value sought for that field. (It’s simpler than it sounds: an example would be:

 @PID.3.1^MR123~@PRT.10^PUMP1
Meaning limit segments given in response to ones involving patient identifier MR123 and device identifier PUMP1.

FLDELEMENT NAMEPID.3Patient Identifier ListPV1.3Assigned Patient LocationPRT.10Participation DeviceRCP Segment
RCP - Response Control Parameter
FieldDescriptionTypeOptionalityLengthTableRepetition1Query PriorityIDR191No2Query Limited RequestX3Response ModalityCNE4Execution and Deliver Time5Modify IndicatoryID
The possible values for RCP-1, Query Priority, are:

ValueDescriptionCommentDDeferredIImmediate
“Immediate” mode corresponds to a “one-shot” information request. “Deferred” mode can specify a persistent “subscription” to events matching the query specification.
Quantity limited requests are not supported, so RCP-2 Quantity Limited Request value is not used.
The supported values of RCP-3 Response Modality are R (Real Time) or T (Bolus)
RCP-4 Execution and Delivery Time is required when RCP-1 contains the value of RCP-1 D (Deferred). It specifies when the response is to be returned. It can be used in a subscription to give a future time when a subscription is to be terminated.
RCP-5 Modify Indicator specifies whether a new subscription is being requested (value: N), or a modification is being made to an existing subscription (M). QPD-4 Action Code can signify the deletion of a subscription with a value of D.
A.5 Query Response Message

RSPSegment Pattern ResponseMSHMessage HeaderMSAMessage Acknowledgement[ {ERR} ]ErrorQAKQuery AcknowledgementQPDQuery Parameter Definition{--- Association Begin PIDPatient Identification [PV1]Patient Visit Information (for room bed)  OBRObservation OBXObservation (for Patient ID) { PRT }Participation (Observation Participation)}--- Association End
A.5.1 MSH Segment
As for transaction PCD-01 in the IHE PCD Technical Framework.
A.5.2 MSA Segment
As for the generic HL7 QSB query
A.5.3 QAK Segment
The QAK segment gives a query tag identifying the particular query instance, for tracking

SEQLENDTOPTTBL#ELEMENT NAME132STRQuery Tag22IDR+0208Query Response Status
A.5.4 QPD Segment
The query response simply echoes the QPD segment from the query here.
A.5.5 Remaining Segments
The remaining segments in the segment pattern correspond to any associations matching the query specification.








[P1]Is this the same as Device Registrant above?
[RJ2]Doug and Megan: Please review the terms for whether they are still need in the doc and whether any updates to definitions are wanted.
[RJ3]Keep (in first cut), reconsider later
[RJ4]Hold for now
[RJ5]After transaction IDs, settled, update this. Also, do we want to depict PAM and PDQ also?
[P6R5]De-emphasize, do not put in diagram.
[P7R5]Will discuss in cross profile considerations.
[P8]I originally pictured the opposite direction for the message between the Device Registrant and the Association Manager – devices are registered infrequently by Biomed staff, and the device information is then fed to the AM either by HL7 feed or in response to a query from the AM to the DR. Just want to confirm that our understanding of the DR actor is the same. 
[RJ9]Query response not numbered here
[RJ10]Finish putting in the linkages
[P11]Should it also respond to queries – e.g., what devices are in room 220 West?
[P12]Can’t get this left aligned without the heading level decrementing. Ugh.
[RJ13]Do we want to identify options? For example, do we want to make supporting subscriptions, as opposed to snapshots, an option
[P14R13]We could have two options for Device-Patient Association Consumer actor.  A continuously updated display of associations vs. a point in time snapshot of associations.
[RJ15]Here we might go into background identity concepts for persons and for devices: unique identifiers
[P16R15]Assume within the scope of institution there will be unique ids for patients and devices (MRN, MPI | UDI, Inventory ID, S/N, etc.)
[RJ17]Something missing here?
[RJ18R17]
